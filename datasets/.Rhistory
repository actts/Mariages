library(readxl)
VIN_2009 <- read_excel("~/Open data/datapot_vin/DATASETS_PROD_VIN/VIN_2009.xlsx")
View(VIN_2009)
devtools::install_github("rstudio/shinyapps")
install.packages('rsconnect')
library(shiny)
ui<-fluidPage(
radioButtons(inputId="sexe1", label="Vous êtes ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE),
radioButtons(inputId="sexe2", label="Vous cherchez ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE)
)
server<-function(input, output) {plotOutput("hist")}
shinyApp(ui = ui, server= server)
#input
ui<-fluidPage(
radioButtons(inputId="sexe1", label="Vous êtes ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE),
radioButtons(inputId="sexe2", label="Vous cherchez ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE)
)
#output
server<-function(input, output) {plotOutput("hist")}
shinyApp(ui = ui, server= server)
shiny::runApp('Etudes/Mariages/ShinyApp')
install.packages('rsconnect')
install.packages("rsconnect")
rsconnect::setAccountInfo(name='andreapps',
token='453A3382C6A71B5D786603B8DE8C5258',
secret='3sTXIBykCUn/n6CZQNWVISboFJeGdYWIabKkxGV7')
library(rsconnect)
rsconnect::deployApp('C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp')
library(shiny)
ui<-fluidPage(
radioButtons(inputId="sexe1", label="Vous êtes ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE),
radioButtons(inputId="sexe2", label="Vous cherchez ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE)
)
#input
ui<-fluidPage(
radioButtons(inputId="sexe1", label="Vous êtes ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE),
radioButtons(inputId="sexe2", label="Vous cherchez ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE)
)
#output
server<-function(input, output) {plotOutput("hist")}
shinyApp(ui = ui, server= server)
#input
ui<-fluidPage(
radioButtons(inputId="sexe1", label="Vous êtes ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE),
radioButtons(inputId="sexe2", label="Vous cherchez ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE)
)
#output
server<-function(input, output) {plotOutput("hist")}
shinyApp(ui = ui, server= server)
install.packages('rsconnect')
rsconnect::setAccountInfo(name='andreapps',
token='453A3382C6A71B5D786603B8DE8C5258',
secret='3sTXIBykCUn/n6CZQNWVISboFJeGdYWIabKkxGV7')
library(rsconnect)
rsconnect::deployApp('C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp/app.r')
install.packages("rsconnect")
install.packages('rsconnect')
rsconnect::setAccountInfo(name='andreapps',
token='453A3382C6A71B5D786603B8DE8C5258',
secret='3sTXIBykCUn/n6CZQNWVISboFJeGdYWIabKkxGV7')
library(rsconnect)
rsconnect::deployApp('C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp/app.r')
rsconnect::deployApp("C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp/app.r")
rsconnect::deployApp("C:\Users\acottais\Documents\Etudes\Mariages\ShinyApp\app.r")
rsconnect::deployApp("C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp")
rsconnect::deployApp("C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp")
install.packages('rsconnect')
rsconnect::setAccountInfo(name='andreapps',
token='453A3382C6A71B5D786603B8DE8C5258',
secret='3sTXIBykCUn/n6CZQNWVISboFJeGdYWIabKkxGV7')
library(rsconnect)
rsconnect::deployApp("C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp/app.r")
install.packages("rsconnect")
rsconnect::deployApp("C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp")
rsconnect::deployApp("C:/Users/acottais/Documents/app")
rsconnect::deployApp("C:/Users/acottais/Documents/app")
rsconnect::deployApp("C:/Users/acottais/Documents/app")
rsconnect::deployApp("C:/Users/acottais/Documents/app", test)
rsconnect::deployApp("C:/Users/acottais/Documents/app/test", test)
rsconnect::deployApp("C:/Users/acottais/Documents/app/test", name="test")
rsconnect::deployApp("C:/Users/acottais/Documents/app/test")
#input
ui<-fluidPage(
radioButtons(inputId="sexe1", label="Vous êtes ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE),
radioButtons(inputId="sexe2", label="Vous cherchez ?", choices=c("Femme","Homme"), selected=NULL,inline=FALSE),
selectInput(inputId="dep", label="De quel département venez vous ?", selected=NULL, multiple=FALSE, selectize=TRUE)
)
#output
server<-function(input, output) {plotOutput("hist")}
shinyApp(ui = ui, server= server)
library(shiny)
library(shinyapps)
shiny::runApp('Etudes/Mariages/ShinyApp')
#nettoyage de l'espace de travail
rm(list=ls())
#----Fonction d'importation et nettoyage
impor_netto<-function(CHEMIN, ANNEE){
#importation
marANNEE<-read.table(CHEMIN, sep=";", stringsAsFactors=FALSE,header=TRUE)
#uniformisation des donnÃ©es
marANNEE<-marANNEE[,-18]
#sans les DOM TOM
if ( ANNEE=="1998"|ANNEE=="1999"|ANNEE=="2000"|ANNEE=="2001"|ANNEE=="2002"|ANNEE=="2003"|ANNEE=="2004"|ANNEE=="2005"|ANNEE=="2006"|ANNEE=="2007"|ANNEE=="2008"|ANNEE=="2009")
{
marANNEE<-marANNEE[marANNEE$DEPNAIS1!="97"&marANNEE$DEPNAIS1!="98"&marANNEE$DEPNAIS1!="99"&marANNEE$DEPNAIS2!="97"&marANNEE$DEPNAIS2!="98"&marANNEE$DEPNAIS2!="99"
&marANNEE$DEPMAR!="97"&marANNEE$DEPMAR!="98"&marANNEE$DEPMAR!="99"&marANNEE$DEPDOM!="97"&marANNEE$DEPDOM!="98"&marANNEE$DEPDOM!="99",]
}
else if ( ANNEE == "2010")
{
marANNEE<-marANNEE[	 marANNEE$DEPNAIS1!="971"&marANNEE$DEPNAIS1!="972"&marANNEE$DEPNAIS1!="973"&marANNEE$DEPNAIS1!="974"&marANNEE$DEPNAIS1!="975"&marANNEE$DEPNAIS1!="977"&marANNEE$DEPNAIS1!="978"&marANNEE$DEPNAIS1!="984"&marANNEE$DEPNAIS1!="985"&marANNEE$DEPNAIS1!="986"&marANNEE$DEPNAIS1!="987"&marANNEE$DEPNAIS1!="988"&marANNEE$DEPNAIS1!="99"
&marANNEE$DEPNAIS2!="971"&marANNEE$DEPNAIS2!="972"&marANNEE$DEPNAIS2!="973"&marANNEE$DEPNAIS2!="974"&marANNEE$DEPNAIS2!="975"&marANNEE$DEPNAIS2!="977"&marANNEE$DEPNAIS2!="978"&marANNEE$DEPNAIS2!="984"&marANNEE$DEPNAIS2!="985"&marANNEE$DEPNAIS2!="986"&marANNEE$DEPNAIS2!="987"&marANNEE$DEPNAIS2!="988"&marANNEE$DEPNAIS2!="99"
&marANNEE$DEPMAR!="971"&marANNEE$DEPMAR!="972"&marANNEE$DEPMAR!="973"&marANNEE$DEPMAR!="974"&marANNEE$DEPMAR!="975"&marANNEE$DEPMAR!="977"&marANNEE$DEPMAR!="978"&marANNEE$DEPMAR!="984"&marANNEE$DEPMAR!="985"&marANNEE$DEPMAR!="986"&marANNEE$DEPMAR!="987"&marANNEE$DEPMAR!="988"&marANNEE$DEPMAR!="99"
&marANNEE$DEPDOM!="971"&marANNEE$DEPDOM!="972"&marANNEE$DEPDOM!="973"&marANNEE$DEPDOM!="974"&marANNEE$DEPDOM!="975"&marANNEE$DEPDOM!="977"&marANNEE$DEPDOM!="978"&marANNEE$DEPDOM!="984"&marANNEE$DEPDOM!="985"&marANNEE$DEPDOM!="986"&marANNEE$DEPDOM!="987"&marANNEE$DEPDOM!="988"&marANNEE$DEPDOM!="99",]
}
else
marANNEE<-marANNEE[	marANNEE$DEPNAIS1!="971"&marANNEE$DEPNAIS1!="972"&marANNEE$DEPNAIS1!="973"&marANNEE$DEPNAIS1!="974" &marANNEE$DEPNAIS1!="975"&marANNEE$DEPNAIS1!="976"&marANNEE$DEPNAIS1!="977"&marANNEE$DEPNAIS1!="978"&marANNEE$DEPNAIS1!="984"&marANNEE$DEPNAIS1!="985"&marANNEE$DEPNAIS1!="986"&marANNEE$DEPNAIS1!="987"&marANNEE$DEPNAIS1!="988"&marANNEE$DEPNAIS1!="99"
&marANNEE$DEPNAIS2!="971"&marANNEE$DEPNAIS2!="972"&marANNEE$DEPNAIS2!="973"&marANNEE$DEPNAIS2!="974"&marANNEE$DEPNAIS2!="975"&marANNEE$DEPNAIS2!="976"&marANNEE$DEPNAIS2!="977"&marANNEE$DEPNAIS2!="978"&marANNEE$DEPNAIS2!="984"&marANNEE$DEPNAIS2!="985"&marANNEE$DEPNAIS2!="986"&marANNEE$DEPNAIS2!="987"&marANNEE$DEPNAIS2!="988"&marANNEE$DEPNAIS2!="99"
&marANNEE$DEPMAR!="971"&marANNEE$DEPMAR!="972"&marANNEE$DEPMAR!="973"&marANNEE$DEPMAR!="974"&marANNEE$DEPMAR!="975"&marANNEE$DEPMAR!="976"&marANNEE$DEPMAR!="977"&marANNEE$DEPMAR!="978"&marANNEE$DEPMAR!="984"&marANNEE$DEPMAR!="985"&marANNEE$DEPMAR!="986"&marANNEE$DEPMAR!="987"&marANNEE$DEPMAR!="988"&marANNEE$DEPMAR!="988"&marANNEE$DEPMAR!="99"
&marANNEE$DEPDOM!="971"&marANNEE$DEPDOM!="972"&marANNEE$DEPDOM!="973"&marANNEE$DEPDOM!="974"&marANNEE$DEPDOM!="975"&marANNEE$DEPDOM!="976"&marANNEE$DEPDOM!="977"&marANNEE$DEPDOM!="978"&marANNEE$DEPDOM!="984"&marANNEE$DEPDOM!="985"&marANNEE$DEPDOM!="986"&marANNEE$DEPDOM!="987"&marANNEE$DEPDOM!="988"&marANNEE$DEPDOM!="99",]
return(marANNEE)
}
#installation package et librairies
library(shiny)
install.packages("wordcloud") # gÃ©nÃ©rateur de word-cloud
install.packages("RColorBrewer") # Palettes de couleurs
library("wordcloud")
library("RColorBrewer")
#importation et nettoyage des donnÃ©es
#paramÃ¨tres :
#CHEMIN : CHEMIN oÃ¹ se trouve le fichier Ã  importer (-> remplacer les \antislash par des /slash)
#ANNEE : annÃ©e du jeu de donnÃ©es
mar1998<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages1998_FR.csv",ANNEE="1998")
mar1999<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages1999_FR.csv",ANNEE="1999")
mar2000<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2000_FR.csv",ANNEE="2000")
mar2001<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2001_FR.csv",ANNEE="2001")
mar2002<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2002_FR.csv",ANNEE="2002")
mar2003<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2003_FR.csv",ANNEE="2003")
mar2004<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2004_FR.csv",ANNEE="2004")
mar2005<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2005_FR.csv",ANNEE="2005")
mar2006<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2006_FR.csv",ANNEE="2006")
mar2007<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2007_FR.csv",ANNEE="2007")
mar2008<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2008_FR.csv",ANNEE="2008")
mar2009<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2009_FR.csv",ANNEE="2009")
mar2010<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2010_FR.csv",ANNEE="2010")
mar2011<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2011_FR.csv",ANNEE="2011")
mar2012<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2012_FR.csv",ANNEE="2012")
mar2013<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2013_FR.csv",ANNEE="2013")
mar2014<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2014_FR.csv",ANNEE="2014")
mar2015<-impor_netto(CHEMIN="C:/Users/acottais/Documents/Etudes/Mariages/mariages2015_FR.csv",ANNEE="2015")
#fusion : jeux de donnÃ©es regroupant la totalitÃ© des mariages
MARIAGES<-rbind(mar1998,mar1999,mar2000,mar2001,mar2002,mar2003,mar2004,mar2005,mar2006,mar2007,mar2008,mar2009,mar2010,mar2011,mar2012,mar2013,mar2014,mar2015)
#Ã¢ge du conjoint 1
#Mise en place des tranches d'Ã¢ge :
#1 : - de 30 ans
#2 : entre 30 et 50 ans
#3 : + de 50 ans
MARIAGES$AGE1<-MARIAGES$AMAR-MARIAGES$ANAIS1
MARIAGES$TAGE1<-MARIAGES$AMAR-MARIAGES$ANAIS1
MARIAGES$TAGE1<-replace(MARIAGES$TAGE1, MARIAGES$TAGE1<30,1)
MARIAGES$TAGE1<-replace(MARIAGES$TAGE1, MARIAGES$TAGE1>50,3)
MARIAGES$TAGE1<-replace(MARIAGES$TAGE1, MARIAGES$TAGE1>3,2)
#Ã¢ge conjoint 2
MARIAGES$AGE2<-MARIAGES$AMAR-MARIAGES$ANAIS2
MARIAGES$TAGE2<-MARIAGES$AMAR-MARIAGES$ANAIS2
MARIAGES$TAGE2<-replace(MARIAGES$TAGE2, MARIAGES$TAGE2<30,1)
MARIAGES$TAGE2<-replace(MARIAGES$TAGE2, MARIAGES$TAGE2>50,3)
MARIAGES$TAGE2<-replace(MARIAGES$TAGE2, MARIAGES$TAGE2>3,2)
#Jeu de donnÃ©e associant le num du dep Ã  son libellÃ©
DEPLIB<-read.table("C:/Users/acottais/Documents/Etudes/Mariages/listeDEP.csv", sep=";", stringsAsFactors=FALSE,header=TRUE)
#ConsidÃ¨re slmt les mariages oÃ¹ les conjoints viennent de dep diffÃ©rents
DDEP<-MARIAGES[MARIAGES$DEPNAIS1!=MARIAGES$DEPNAIS2,]
#ConsidÃ¨re les mariages oÃ¹ les conjoints viennent du mm dÃ©p
MDEP<-MARIAGES[MARIAGES$DEPNAIS1==MARIAGES$DEPNAIS2,]
#installation package et librairies
library(shiny)
install.packages("wordcloud") # gÃ©nÃ©rateur de word-cloud
install.packages("RColorBrewer") # Palettes de couleurs
library("wordcloud")
library("RColorBrewer")
setwd("C:/Users/acottais/Documents/Etudes/Mariages/ShinyApp/datasets")
#importation et nettoyage des donnÃ©es
#paramÃ¨tres :
#CHEMIN : CHEMIN oÃ¹ se trouve le fichier Ã  importer (-> remplacer les \antislash par des /slash)
#ANNEE : annÃ©e du jeu de donnÃ©es
mar1998<-impor_netto(CHEMIN="mariages1998_FR.csv",ANNEE="1998")
mar1999<-impor_netto(CHEMIN="mariages1999_FR.csv",ANNEE="1999")
mar2000<-impor_netto(CHEMIN="mariages2000_FR.csv",ANNEE="2000")
mar2001<-impor_netto(CHEMIN="mariages2001_FR.csv",ANNEE="2001")
mar2002<-impor_netto(CHEMIN="mariages2002_FR.csv",ANNEE="2002")
mar2003<-impor_netto(CHEMIN="mariages2003_FR.csv",ANNEE="2003")
mar2004<-impor_netto(CHEMIN="mariages2004_FR.csv",ANNEE="2004")
mar2005<-impor_netto(CHEMIN="mariages2005_FR.csv",ANNEE="2005")
mar2006<-impor_netto(CHEMIN="mariages2006_FR.csv",ANNEE="2006")
mar2007<-impor_netto(CHEMIN="mariages2007_FR.csv",ANNEE="2007")
mar2008<-impor_netto(CHEMIN="mariages2008_FR.csv",ANNEE="2008")
mar2009<-impor_netto(CHEMIN="mariages2009_FR.csv",ANNEE="2009")
mar2010<-impor_netto(CHEMIN="mariages2010_FR.csv",ANNEE="2010")
mar2011<-impor_netto(CHEMIN="mariages2011_FR.csv",ANNEE="2011")
mar2012<-impor_netto(CHEMIN="mariages2012_FR.csv",ANNEE="2012")
mar2013<-impor_netto(CHEMIN="mariages2013_FR.csv",ANNEE="2013")
mar2014<-impor_netto(CHEMIN="mariages2014_FR.csv",ANNEE="2014")
mar2015<-impor_netto(CHEMIN="mariages2015_FR.csv",ANNEE="2015")
#fusion : jeux de donnÃ©es regroupant la totalitÃ© des mariages
MARIAGES<-rbind(mar1998,mar1999,mar2000,mar2001,mar2002,mar2003,mar2004,mar2005,mar2006,mar2007,mar2008,mar2009,mar2010,mar2011,mar2012,mar2013,mar2014,mar2015)
#Ã¢ge du conjoint 1
#Mise en place des tranches d'Ã¢ge :
#1 : - de 30 ans
#2 : entre 30 et 50 ans
#3 : + de 50 ans
MARIAGES$AGE1<-MARIAGES$AMAR-MARIAGES$ANAIS1
MARIAGES$TAGE1<-MARIAGES$AMAR-MARIAGES$ANAIS1
MARIAGES$TAGE1<-replace(MARIAGES$TAGE1, MARIAGES$TAGE1<30,1)
MARIAGES$TAGE1<-replace(MARIAGES$TAGE1, MARIAGES$TAGE1>50,3)
MARIAGES$TAGE1<-replace(MARIAGES$TAGE1, MARIAGES$TAGE1>3,2)
#Ã¢ge conjoint 2
MARIAGES$AGE2<-MARIAGES$AMAR-MARIAGES$ANAIS2
MARIAGES$TAGE2<-MARIAGES$AMAR-MARIAGES$ANAIS2
MARIAGES$TAGE2<-replace(MARIAGES$TAGE2, MARIAGES$TAGE2<30,1)
MARIAGES$TAGE2<-replace(MARIAGES$TAGE2, MARIAGES$TAGE2>50,3)
MARIAGES$TAGE2<-replace(MARIAGES$TAGE2, MARIAGES$TAGE2>3,2)
#Jeu de donnÃ©e associant le num du dep Ã  son libellÃ©
DEPLIB<-read.table("C:/Users/acottais/Documents/Etudes/Mariages/listeDEP.csv", sep=";", stringsAsFactors=FALSE,header=TRUE)
#ConsidÃ¨re slmt les mariages oÃ¹ les conjoints viennent de dep diffÃ©rents
DDEP<-MARIAGES[MARIAGES$DEPNAIS1!=MARIAGES$DEPNAIS2,]
#ConsidÃ¨re les mariages oÃ¹ les conjoints viennent du mm dÃ©p
MDEP<-MARIAGES[MARIAGES$DEPNAIS1==MARIAGES$DEPNAIS2,]
install.packages("wordcloud")
install.packages("RColorBrewer")
install.packages("RColorBrewer")
#Jeu de donnÃ©e associant le num du dep Ã  son libellÃ©
DEPLIB<-read.table("listeDEP.csv", sep=";", stringsAsFactors=FALSE,header=TRUE)
#input : partie interface utilisateur, gÃ¨re les diffÃ©rentes entrÃ©es de l'utilisateur
ui<-fluidPage(
titlePanel("D'oÃ¹ vient votre data-lover ?"),
sidebarLayout(
sidebarPanel(
radioButtons(
inputId="sexe1",
label="Vous Ãªtes ?",
choices=c("Homme","Femme"),
selected=NULL,
inline=FALSE
),
radioButtons(
inputId="sexe2",
label="Vous cherchez ?",
choices=c("Femme","Homme"),
selected=NULL,
inline=FALSE
),
selectInput(
inputId="dep",
label="De quel dÃ©partement venez vous ?",
choices= c("1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","2A","2B"),
selected=NULL,
multiple=FALSE,
selectize=TRUE
),
sliderInput(
"age",
"Quel Ã¢ge avez vous ?",
min = 18,  max = 99, value = 1
)
),
mainPanel(
#pourcentage du mm dep
textOutput('text1'),
#wordcloud
plotOutput('nuage'),
#age moyen du conjoint
textOutput('text2'),
#pourcentage de lieux mariage dans le dep
textOutput('text3'),
#nb obs pour le cas considÃ©rÃ©
textOutput('textfin')
)
)
)
#output	: partie serveur, gÃ¨re les objets Ã  retourner
server<-function(input, output, session) {
#Tranche d'Ã¢ge selon Ã¢ge entrÃ©
TAGE<-reactive({
if (input$age<30){
TAGE<-1
}
else if (input$age>=30&input$age<50){
TAGE<-2
}
else if (input$age>=50){
TAGE<-3
}
})
#A partir d'ici, nous considÃ©rerons la personne
#Exemple : Mdata1 > lorsque la personne considÃ©rÃ©e = variables[1] et le conjoint considÃ©rÃ© = variables[2]
#Ddata : jeu de donnÃ©es correspondant au profil avec conjoint dep diff
#Ddata0 > versions correspondant aux genres
Ddata0<-reactive({
#DonnÃ©es correspondant aux genres Ã¢ge et dÃ©partement
if (input$sexe1=="Homme"&input$sexe2=="Homme") {
Ddata1<-DDEP[DDEP$SEXE1=="H"&DDEP$SEXE2=="H",]
}  else if ( input$sexe1=="Femme"&input$sexe2=="Femme") {
Ddata1<-DDEP[DDEP$SEXE1=="FE"&DDEP$SEXE2=="FE",]
}else if (input$sexe1!=input$sexe2){
Ddata1<-DDEP[DDEP$SEXE1!=DDEP$SEXE2,]
}
})
Ddata1<-reactive({
Ddata1<-Ddata0()[Ddata0()$TAGE1==TAGE()&Ddata0()$DEPNAIS1==input$dep,]
})
Ddata2<-reactive({
Ddata2<-Ddata0()[Ddata0()$TAGE2==TAGE()&Ddata0()$DEPNAIS2==input$dep,]
})
#Mdata : jeu de donnÃ©es correspondant au profil avec conjoint meme dep
Mdata0<-reactive({
#DonnÃ©es dep et sexes
if (input$sexe1=="Homme"&input$sexe2=="Homme") {
Mdata<-MDEP[MDEP$DEPNAIS1==input$dep&MDEP$SEXE1==MDEP$SEXE2&MDEP$SEXE1=="M",]
} else if ( input$sexe1=="Femme"&input$sexe2=="Femme") {
Mdata<-MDEP[MDEP$DEPNAIS1==input$dep&MDEP$SEXE1==MDEP$SEXE2&MDEP$SEXE1=="FE",]
} else if (input$sexe1!=input$sexe2){
Mdata<-MDEP[MDEP$DEPNAIS1==input$dep&MDEP$SEXE1!=MDEP$SEXE2,]
}
})
Mdata1<-reactive({
Mdata1<-Mdata0()[Mdata0()$TAGE1==TAGE(),]
})
Mdata2<-reactive({
Mdata2<-Mdata0()[Mdata0()$TAGE2==TAGE(),]
})
#Mterms : Table finale term/freq > wordcloud
Mterms<-reactive({
Ddata<-rbind(Ddata1(),Ddata2())
Mdata<-rbind(Ddata1(),Ddata2())
#Changement des tables pour correspondre Ã  la table term/freq
#TABLE1 et 2 : effectif de mariages par dÃ©partement
#considÃ¨re le dÃ©partement de la 1ere puis 2e colonne
TABLE1<-cbind(names(table(Ddata$DEPNAIS1)),as.matrix(table(Ddata$DEPNAIS1)))
TABLE2<-cbind(names(table(Ddata$DEPNAIS2)),as.matrix(table(Ddata$DEPNAIS2)))
colnames(TABLE1)<-c("dep","freq1")
colnames(TABLE2)<-c("dep","freq2")
#Fusion : objectif: table des frÃ©quences de mariages par dÃ©partement pour le cas considÃ©rÃ© (HF/HH/FF)
TABLE<-merge(TABLE1,TABLE2, by="dep", all=TRUE)
#Le dÃ©partement considÃ©rÃ© est forcÃ©ment bcp + grand,
#on lui donne la valeur 0 pour que le wordcloud montre correctement les nuances entre les autres dÃ©p.
TABLE[TABLE$dep==input$dep,2]<-0
TABLE[TABLE$dep==input$dep,3]<-0
#Fusion avec DEPLIB : libellÃ©s des dep
TABLE<-merge(DEPLIB,TABLE, by.x="DEP",by.y="dep",all.y=TRUE)
#passage des valeurs en numÃ©rique pour le wordcloud
TABLE$freq1<-as.numeric(paste(TABLE$freq1))
TABLE$freq2<-as.numeric(paste(TABLE$freq2))
#as.numeric afficher des NA lorsque les valeurs sont vides, on les remplace par 0
TABLE<-replace(TABLE,is.na(TABLE),0)
#On additionne les frÃ©quence de TABLE1 et 2 une fois uniformisÃ©
TABLE$freq<-paste(TABLE$freq1+TABLE$freq2)
#On supprime les
TABLE<-TABLE[,-c(1,3,4)]
TABLE$freq<-as.numeric(paste(TABLE$freq))
Terms<-TABLE
})
output$nuage <- renderPlot({
wordcloud(words = Mterms()[,1], freq = Mterms()[,2], min.freq = 1,
max.words=20, random.order=FALSE, rot.per=0.5,
colors=brewer.pal(8, "Paired"))
})
output$text1<-renderText({
paste(round((nrow(Mdata1())+nrow(Mdata2()))/(nrow(Mdata1())+nrow(Mdata2())+nrow(Ddata1())+nrow(Ddata2()))*100), " % des personnes correspondant Ã  votre profil ont un conjoint originaire du mÃªme dÃ©partement. Sinon, les dÃ©partements les plus reprÃ©sentÃ©s sont les suivants :")
})
output$text2<-renderText({
#numÃ©rateur
num<-sum(Ddata1()$AGE2)+sum(Ddata2()$AGE1)+sum(Mdata1()$AGE2)+sum(Mdata2()$AGE1)
#dÃ©nominateur
denom<-nrow(Mdata1())+nrow(Mdata2())+nrow(Ddata1())+nrow(Ddata2())
age<-round(num/denom)
paste("Age moyen de votre Ã¢me soeur :",age)
})
output$text3<-renderText({
num<-nrow(Mdata1()[Mdata1()$DEPNAIS1==Mdata1()$DEPMAR,])+nrow(Mdata2()[Mdata2()$DEPNAIS2==Mdata2()$DEPMAR,])+nrow(Ddata1()[Ddata1()$DEPNAIS1==Ddata1()$DEPMAR,])+nrow(Ddata2()[Ddata2()$DEPNAIS2==Ddata2()$DEPMAR,])
denom<-nrow(Mdata1())+nrow(Mdata2())+nrow(Ddata1())+nrow(Ddata1())
depmar<-round(num/denom*100)
paste(depmar, "% des personnes du mÃªme profil se marient dans le dÃ©partement dans lequel ils sont nÃ©s")
})
output$textfin<-renderText({
paste("Observation rÃ©alisÃ©e grÃ¢ce Ã  un recensement de",nrow(Ddata1())+nrow(Ddata2()), " personnes mariÃ©es prÃ©sentant votre profil sur ", 2*nrow(MARIAGES), "personnes totales.")
})
}
shinyApp(ui = ui, server= server)
